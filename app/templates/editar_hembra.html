{% extends 'base.html' %}
{% block title %}Editar Hembra{% endblock %}
{% block content %}
<div class="d-flex justify-content-center mt-4">
  <div class="login-box">
    <h4 class="mb-3">Editar Hembra</h4>
    <form id="hembraForm" method="POST" action="{{ url_for('ganaderia.editar_hembra', hembra_id=hembra.id) }}" enctype="multipart/form-data" data-create-url="{{ url_for('ganaderia.registro_hembras') }}">
      <div class="mb-3">
        <label class="form-label">No Hembra</label>
        <input type="text" class="form-control" value="{{ hembra.numero }}" disabled>
      </div>
      <div class="mb-3">
        <label class="form-label">Nombre</label>
        <input type="text" name="nombre" class="form-control" value="{{ hembra.nombre }}" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Tipo</label>
        <select name="tipo" class="form-select">
          <option value="Leche" {% if hembra.tipo=='Leche' %}selected{% endif %}>Leche</option>
          <option value="Carne" {% if hembra.tipo=='Carne' %}selected{% endif %}>Carne</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="form-label">Condición</label>
        <select name="condicion" class="form-select" required>
          <option value="2" {% if hembra.condicion==2 %}selected{% endif %}>2</option>
          <option value="2.5" {% if hembra.condicion==2.5 %}selected{% endif %}>2.5</option>
          <option value="3" {% if hembra.condicion==3 %}selected{% endif %}>3</option>
          <option value="3.5" {% if hembra.condicion==3.5 %}selected{% endif %}>3.5</option>
          <option value="4" {% if hembra.condicion==4 %}selected{% endif %}>4</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="form-label">Foto</label>
        {% if hembra.foto %}
        <div class="mb-2">
          <img src="{{ url_for('static', filename=hembra.foto) }}" class="img-thumbnail" style="max-width:150px">
        </div>
        {% endif %}
        <input type="file" name="foto" class="form-control" accept=".jpg,.jpeg,.png">
      </div>
      <div class="mb-3 form-check">
        <input type="hidden" name="activo" value="0">
        <input type="checkbox" class="form-check-input" id="activo" name="activo" value="1" {% if hembra.activo %}checked{% endif %}>
        <label class="form-check-label" for="activo">Activo</label>
      </div>
      <div class="mb-3">
        <label class="form-label">Fecha de nacimiento</label>
        <input type="date" name="fecha_nacimiento" class="form-control" value="{{ hembra.fecha_nacimiento }}">
      </div>
      <div class="mb-3">
        <label class="form-label">Origen</label>
        <select name="origen" class="form-select">
          <option value="Cría" {% if hembra.origen=='Cría' %}selected{% endif %}>Cría</option>
          <option value="Compra" {% if hembra.origen=='Compra' %}selected{% endif %}>Compra</option>
          <option value="Otro" {% if hembra.origen=='Otro' %}selected{% endif %}>Otro</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="form-label">Fecha de incorporación</label>
        <input type="date" name="fecha_incorporacion" class="form-control" value="{{ hembra.fecha_incorporacion }}">
      </div>
      <div class="mb-3">
        <label class="form-label">Padre</label>
        <select name="padre_id" class="form-select">
          <option value="">-- Selección --</option>
          {% for p in machos %}
          <option value="{{ p.id }}" {% if hembra.padre_id==p.id %}selected{% endif %}>{{ p.numero }} - {{ p.nombre }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="mb-3">
        <label class="form-label">Madre</label>
        <select name="madre_id" class="form-select">
          <option value="">-- Selección --</option>
          {% for m in madres %}
          <option value="{{ m.id }}" {% if hembra.madre_id==m.id %}selected{% endif %}>{{ m.numero }} - {{ m.nombre }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="mb-3">
        <label class="form-label">Fecha de desincorporación</label>
        <input type="date" id="fecha_desincorporacion" name="fecha_desincorporacion" class="form-control" value="{{ hembra.fecha_desincorporacion }}">
      </div>
      <div class="mb-3">
        <label class="form-label">Causa de desincorporación</label>
        <textarea id="causa_desincorporacion" name="causa_desincorporacion" class="form-control">{{ hembra.causa_desincorporacion }}</textarea>
      </div>
      <button type="submit" id="submitBtn" class="btn btn-primary w-100">Actualizar</button>
      <button type="button" id="refreshBtn" class="btn btn-outline-secondary w-100 mt-2">Limpiar</button>
    </form>
    <a href="{{ url_for('ganaderia.registro_hembras') }}" class="btn btn-secondary w-100 mt-2">Volver</a>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
  const form = document.querySelector('form');
  const activoSwitch = document.getElementById('activo');
  const fechaDesinc = document.getElementById('fecha_desincorporacion');
  const causaDesinc = document.getElementById('causa_desincorporacion');
  const submitBtn = document.getElementById('submitBtn');
  const refreshBtn = document.getElementById('refreshBtn');

  const fields = Array.from(
    form.querySelectorAll('input[name]:not([type="hidden"]), select[name], textarea[name]')
  );

  function toggleFields(isActive) {
    fields.forEach(field => {
      if (field === activoSwitch) return; // keep switch enabled
      if (field === fechaDesinc || field === causaDesinc) {
        field.disabled = isActive; // disable when active
      } else {
        field.disabled = !isActive; // disable others when inactive
      }
    });
    fechaDesinc.required = !isActive;
    causaDesinc.required = !isActive;
  }
  

  // Initial state on load
  toggleFields(activoSwitch.checked);

  // Toggle on switch change
  activoSwitch.addEventListener('change', () => toggleFields(activoSwitch.checked));

  // Refresh form
  refreshBtn.addEventListener('click', function () {
    fields.forEach(field => {
      if (field.type === 'checkbox') {
        field.checked = false;
      } else if (field.tagName === 'SELECT') {
        field.selectedIndex = 0;
      } else {
        field.value = '';
      }
      field.disabled = false;
    });

    activoSwitch.checked = true;
    toggleFields(true);

    submitBtn.textContent = 'Guardar';

    document.querySelectorAll('.alert').forEach(a => a.remove());
  });
});
</script>
{% endblock %}